<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Detalhes do Anúncio</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="_config.js"></script>
    <script src="app.js"></script>
    
    <style>
        .gallery-snap { scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .gallery-item { scroll-snap-align: center; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .smooth-transition { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 pb-24 md:pb-0 font-sans">

    <nav class="bg-white h-16 border-b border-gray-200 fixed w-full z-50 top-0 flex items-center justify-between px-4 shadow-sm">
        <a href="index.html" class="text-gray-500 hover:text-brand-600 transition p-2 rounded-full hover:bg-gray-100">
            <i class="fas fa-arrow-left text-xl"></i>
        </a>
        <div class="font-bold text-gray-900 truncate mx-4 flex-1 text-center" id="nav-title">Carregando...</div>
        <button class="text-gray-400 hover:text-red-500 transition p-2 rounded-full hover:bg-gray-100">
            <i class="far fa-heart text-xl"></i>
        </button>
    </nav>

    <div class="max-w-7xl mx-auto md:mt-20 md:px-4 md:grid md:grid-cols-3 md:gap-8">
        
        <div class="md:col-span-2">
            
            <div class="relative w-full h-[350px] md:h-[500px] bg-gray-900 md:rounded-2xl overflow-hidden mt-16 md:mt-0 group shadow-lg">
                <div class="flex overflow-x-auto h-full gallery-snap hide-scroll" id="gallery-container">
                    <div class="w-full h-full flex items-center justify-center text-white">Carregando fotos...</div>
                </div>
                
                <div class="absolute bottom-4 right-4 bg-black/60 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm font-bold">
                    <i class="fas fa-camera mr-1"></i> <span id="photo-count">1/3</span>
                </div>

                <button onclick="scrollGallery(-1)" class="hidden md:flex absolute top-1/2 left-4 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full items-center justify-center hover:bg-white transition shadow-lg text-brand-900"><i class="fas fa-chevron-left"></i></button>
                <button onclick="scrollGallery(1)" class="hidden md:flex absolute top-1/2 right-4 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full items-center justify-center hover:bg-white transition shadow-lg text-brand-900"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="p-5 md:px-0">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <p class="text-xs font-bold text-brand-600 uppercase tracking-wider mb-1" id="prod-category">Categoria</p>
                        <h1 class="text-2xl md:text-3xl font-black text-gray-900 leading-tight" id="prod-title">...</h1>
                    </div>
                </div>
                
                <div class="flex items-center text-sm text-gray-500 mb-6">
                    <i class="fas fa-map-marker-alt text-accent-500 mr-2"></i> <span id="prod-location">Localização</span>
                    <span class="mx-2">•</span>
                    <span>Ref: <span id="prod-ref">000</span></span>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8" id="specs-grid">
                    </div>

                <div class="mb-8">
                    <h3 class="font-bold text-lg text-gray-900 mb-3 border-l-4 border-brand-500 pl-3">Descrição</h3>
                    <div class="text-gray-600 text-sm leading-relaxed space-y-2" id="prod-desc">
                        <p>Carregando descrição detalhada do item...</p>
                    </div>
                </div>

                <div class="border-t border-gray-200 py-4">
                    <button class="flex justify-between items-center w-full font-bold text-brand-600 hover:text-brand-800 transition">
                        Ver Ficha Técnica Completa <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="md:col-span-1 relative">
            <div class="sticky top-24 bg-white md:rounded-2xl md:shadow-lg md:border md:border-gray-100 p-6">
                
                <p class="text-xs text-gray-400 uppercase font-bold mb-1">Valor Solicitado</p>
                <div class="text-4xl font-black text-brand-600 mb-2" id="prod-price">R$ ...</div>
                <p class="text-xs text-accent-700 font-bold bg-accent-50 inline-block px-2 py-1 rounded mb-6 border border-accent-200">
                    <i class="fas fa-tag mr-1"></i> Condição Especial
                </p>

                <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-200">
                    <p class="text-xs font-bold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-calculator text-brand-500 mr-2"></i> Pré-Simulação
                    </p>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-500">Entrada (20%):</span>
                        <span class="font-bold text-gray-800" id="sim-entry">...</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">Parcela est.:</span>
                        <span class="font-bold text-brand-600" id="sim-installment">...</span>
                    </div>
                </div>

                <div class="hidden md:block space-y-3">
                    <button onclick="contatarVendedor()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:-translate-y-1 flex items-center justify-center">
                        <i class="fab fa-whatsapp text-2xl mr-2"></i> Enviar Mensagem
                    </button>
                    <button class="w-full bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 font-bold py-4 rounded-xl transition shadow-sm">
                        Ver Telefone
                    </button>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-100 flex items-center">
                    <div class="relative">
                        <img id="seller-img" src="" class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-gray-200">
                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                    </div>
                    <div class="ml-3">
                        <p class="text-xs text-gray-400 font-bold uppercase">Anunciante</p>
                        <p class="font-bold text-gray-900" id="seller-name">...</p>
                        <div class="flex text-xs text-accent-500">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            <span class="text-gray-400 ml-1">(Verificado)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 w-full bg-white border-t border-gray-200 p-4 md:hidden z-40 flex items-center justify-between shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <div>
            <p class="text-xs text-gray-400 font-bold uppercase">Valor</p>
            <p class="text-xl font-black text-brand-600" id="mobile-price">...</p>
        </div>
        <button onclick="contatarVendedor()" class="bg-green-600 text-white font-bold px-6 py-3 rounded-xl shadow-lg flex items-center active:scale-95 transition">
            <i class="fab fa-whatsapp text-xl mr-2"></i> Tenho Interesse
        </button>
    </div>

    <script>
        // Variável global para guardar o item atual
        let currentItem = null;

        document.addEventListener('DOMContentLoaded', () => {
            carregarProduto();
        });

        function carregarProduto() {
            // 1. Pega o ID da URL (ex: detalhe.html?id=101)
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            // 2. Busca no "Banco de Dados" (_config.js)
            // Se não achar (ou não tiver ID), pega o primeiro item para não quebrar a demo
            if (typeof DB !== 'undefined') {
                currentItem = DB.estoque.find(i => i.id == id) || DB.estoque[0];
            }

            if (!currentItem) return;

            // 3. Preenche os Dados na Tela
            document.title = `${currentItem.titulo} - Detalhes`;
            document.getElementById('nav-title').textContent = currentItem.titulo;
            document.getElementById('prod-title').textContent = currentItem.titulo;
            document.getElementById('prod-category').textContent = currentItem.subtitulo.split('•')[1] || 'Oferta';
            document.getElementById('prod-location').textContent = "Porto Velho, RO"; // Mock, já que não temos no DB simples
            document.getElementById('prod-ref').textContent = `#${currentItem.id}`;
            
            // Preço e Simulação
            const valorFmt = currentItem.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('prod-price').textContent = valorFmt;
            document.getElementById('mobile-price').textContent = valorFmt;
            
            // Cálculo Simples de Simulação
            const entrada = currentItem.valor * 0.20;
            const parcela = (currentItem.valor - entrada) / 60 * 1.15; // Juros fictícios
            document.getElementById('sim-entry').textContent = entrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('sim-installment').textContent = parcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) + "/mês";

            // Descrição Genérica (se não tiver no DB)
            const desc = currentItem.descricao || `Oportunidade única. ${currentItem.titulo} em excelentes condições. Documentação em dia, pronto para transferência. Entre em contato para agendar uma visita ou solicitar mais fotos e vídeos detalhados.`;
            document.getElementById('prod-desc').innerHTML = `<p>${desc}</p>`;

            // Vendedor (Pega o primeiro da lista ou o usuário atual para demo)
            const vendedor = DB.vendedores[0];
            document.getElementById('seller-name').textContent = vendedor.nome;
            document.getElementById('seller-img').src = vendedor.foto;

            // 4. Renderiza Galeria (Duplicando a imagem para simular carrossel)
            const galleryContainer = document.getElementById('gallery-container');
            const imgs = [currentItem.imagem, currentItem.imagem, currentItem.imagem]; // Mock 3 fotos
            galleryContainer.innerHTML = imgs.map(src => `
                <img src="${src}" class="w-full h-full object-cover flex-shrink-0 gallery-item bg-gray-200">
            `).join('');

            // 5. Renderiza Specs (Mock baseado no tipo)
            renderSpecs(currentItem.titulo);
        }

        function renderSpecs(titulo) {
            const container = document.getElementById('specs-grid');
            let specs = [];

            // Detecta tipo pelo título (lógica simples para demo)
            if(titulo.includes('Fazenda') || titulo.includes('Sítio')) {
                specs = [
                    { label: 'Área Total', val: '500 Ha' },
                    { label: 'Reserva', val: '20%' },
                    { label: 'Documento', val: 'Escritura' },
                    { label: 'Vocação', val: 'Pecuária' }
                ];
            } else if (titulo.includes('Trator') || titulo.includes('Máquina')) {
                specs = [
                    { label: 'Ano', val: '2021' },
                    { label: 'Horas', val: '1.200h' },
                    { label: 'Potência', val: '105 cv' },
                    { label: 'Tração', val: '4x4' }
                ];
            } else {
                specs = [
                    { label: 'Ano', val: '2024' },
                    { label: 'KM', val: '0 km' },
                    { label: 'Combustível', val: 'Diesel' },
                    { label: 'Câmbio', val: 'Automático' }
                ];
            }

            container.innerHTML = specs.map(s => `
                <div class="bg-white p-3 rounded-xl border border-gray-200 text-center">
                    <p class="text-xs text-gray-400 uppercase font-bold">${s.label}</p>
                    <p class="font-bold text-gray-800">${s.val}</p>
                </div>
            `).join('');
        }

        function scrollGallery(direction) {
            const gallery = document.getElementById('gallery-container');
            const scrollAmount = gallery.clientWidth;
            gallery.scrollBy({ left: scrollAmount * direction, behavior: 'smooth' });
        }

        function contatarVendedor() {
            if(!currentItem) return;
            // Pega número do config ou usa padrão
            const phone = "5569992000000"; 
            const text = `Olá! Vi o anúncio *${currentItem.titulo}* (Ref: ${currentItem.id}) no sistema e tenho interesse.`;
            window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(text)}`, '_blank');
        }
    </script>
</body>
</html>
